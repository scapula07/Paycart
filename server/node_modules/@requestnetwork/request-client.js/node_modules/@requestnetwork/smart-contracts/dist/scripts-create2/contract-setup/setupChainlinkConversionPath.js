"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.setupChainlinkConversionPath = void 0;
const tslib_1 = require("tslib");
const currency_1 = require("@requestnetwork/currency");
const types_1 = require("@requestnetwork/types");
const lib_1 = require("../../src/lib");
const adminTasks_1 = require("./adminTasks");
/**
 * Setup the chainlinkConversionPath values once deployed
 * @param contractAddress address of the ChainlinkConversionPath contract
 * @param hre Hardhat runtime environment
 */
const setupChainlinkConversionPath = (contractAddress, hre) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
    // Setup contract parameters
    const ChainlinkConversionPathContract = new hre.ethers.Contract(contractAddress, lib_1.chainlinkConversionPath.getContractAbi());
    yield Promise.all(hre.config.xdeploy.networks.map((network) => tslib_1.__awaiter(void 0, void 0, void 0, function* () {
        var _a;
        try {
            const { signer, txOverrides } = yield (0, adminTasks_1.getSignerAndGasFees)(network, hre);
            const nativeTokenHash = (_a = currency_1.CurrencyManager.getDefault().getNativeCurrency(types_1.RequestLogicTypes.CURRENCY.ETH, network)) === null || _a === void 0 ? void 0 : _a.hash;
            if (!nativeTokenHash) {
                throw new Error(`Could not guess native token hash for network ${network}`);
            }
            const ChainlinkConversionPathConnected = ChainlinkConversionPathContract.connect(signer);
            yield (0, adminTasks_1.updateNativeTokenHash)('ChainlinkConversionPath', ChainlinkConversionPathConnected, nativeTokenHash, txOverrides);
            console.log(`Setup of ChainlinkConversionPath successful on ${network}`);
        }
        catch (err) {
            console.warn(`An error occurred during the setup of ChainlinkConversionPath on ${network}`);
            console.warn(err);
        }
    })));
});
exports.setupChainlinkConversionPath = setupChainlinkConversionPath;
//# sourceMappingURL=setupChainlinkConversionPath.js.map