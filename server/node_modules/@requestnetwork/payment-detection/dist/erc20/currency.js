"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.loadCurrencyFromContract = void 0;
const tslib_1 = require("tslib");
const ethers_1 = require("ethers");
const currency_1 = require("@requestnetwork/currency");
const types_1 = require("@requestnetwork/types");
const types_2 = require("@requestnetwork/smart-contracts/types");
const provider_1 = require("../provider");
const loadCurrencyFromContract = (currency) => (0, tslib_1.__awaiter)(void 0, void 0, void 0, function* () {
    if (!currency.network || !ethers_1.utils.isAddress(currency.value)) {
        return null;
    }
    try {
        const contract = types_2.ERC20__factory.connect(currency.value, (0, provider_1.getDefaultProvider)(currency.network));
        const decimals = yield contract.decimals();
        if (!decimals) {
            return null;
        }
        const symbol = yield contract.symbol();
        if (!symbol) {
            return null;
        }
        const definition = {
            address: currency.value,
            decimals,
            symbol,
            network: currency.network,
            type: types_1.RequestLogicTypes.CURRENCY.ERC20,
        };
        return Object.assign(Object.assign({}, definition), { id: currency_1.CurrencyManager.currencyId(definition), hash: (0, currency_1.getCurrencyHash)(currency_1.CurrencyManager.toStorageCurrency(definition)), meta: null });
    }
    catch (e) {
        return null;
    }
});
exports.loadCurrencyFromContract = loadCurrencyFromContract;
//# sourceMappingURL=currency.js.map