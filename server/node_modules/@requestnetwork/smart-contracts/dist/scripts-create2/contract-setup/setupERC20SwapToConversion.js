"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.setupERC20SwapToConversion = void 0;
const tslib_1 = require("tslib");
const lib_1 = require("../../src/lib");
const utils_1 = require("@requestnetwork/utils");
const adminTasks_1 = require("./adminTasks");
/**
 * Updates the values of the chainlinkConversionPath and swap router of the ERC20SwapToConversion contract, if needed
 * @param contractAddress address of the ERC20SwapToConversion Proxy
 * @param hre Hardhat runtime environment
 */
const setupERC20SwapToConversion = (contractAddress, hre) => (0, tslib_1.__awaiter)(void 0, void 0, void 0, function* () {
    // Setup contract parameters
    const ERC20SwapToConversionContract = new hre.ethers.Contract(contractAddress, lib_1.erc20SwapConversionArtifact.getContractAbi());
    yield Promise.all(hre.config.xdeploy.networks.map((network) => (0, tslib_1.__awaiter)(void 0, void 0, void 0, function* () {
        let provider;
        if (network === 'celo') {
            provider = utils_1.default.getCeloProvider();
        }
        else {
            provider = utils_1.default.getDefaultProvider(network);
        }
        const wallet = new hre.ethers.Wallet(hre.config.xdeploy.signer, provider);
        const signer = wallet.connect(provider);
        const ERC20SwapToConversionConnected = yield ERC20SwapToConversionContract.connect(signer);
        const adminNonce = yield signer.getTransactionCount();
        const gasPrice = yield provider.getGasPrice();
        yield Promise.all([
            (0, adminTasks_1.updateChainlinkConversionPath)(ERC20SwapToConversionConnected, network, adminNonce, gasPrice),
            (0, adminTasks_1.updateSwapRouter)(ERC20SwapToConversionConnected, network, adminNonce + 1, gasPrice),
            (0, adminTasks_1.updateRequestSwapFees)(ERC20SwapToConversionConnected, adminNonce + 2, gasPrice),
        ]);
    })));
    console.log('Setup for ERC20SwapToConversion successfull');
});
exports.setupERC20SwapToConversion = setupERC20SwapToConversion;
//# sourceMappingURL=setupERC20SwapToConversion.js.map